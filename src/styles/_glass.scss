/* Liquid Glass поверхность с поддержкой: дисторсии (SVG), shimmer, fallbacks, профилей слоёв. */

/* Общий миксин поверхности */
@mixin lg-surface($elev: 1, $opacity: var(--lg-opacity)) {
  filter: none;
  position: relative;
  isolation: isolate;
  border-radius: var(--lg-radius);
  background: rgba(255, 255, 255, $opacity); /* fallback для старых браузеров */
  border: 1px solid rgba(255, 255, 255, calc(var(--lg-border) * 0.8));
  box-shadow: 0 10px #{8px * $elev} rgba(0, 0, 0, calc(var(--lg-shadow) * 0.6)),
    inset 0 1px 0 rgba(255, 255, 255, 0.18);

  /* шум + мягкие блики */
  &::before {
    content: '';
    pointer-events: none;
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background-image: radial-gradient(
        120% 140% at 10% 0%,
        rgba(var(--lg-tint), 0.08) 0%,
        rgba(255, 255, 255, 0) 40%
      ),
      radial-gradient(
        140% 120% at 100% 0%,
        rgba(255, 255, 255, var(--lg-highlight)) 0%,
        rgba(255, 255, 255, 0) 55%
      ),
      url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>\
  <filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/></filter>\
  <rect width='64' height='64' filter='url(%23n)' opacity='0.25'/>\
</svg>");
    mix-blend-mode: overlay;
    opacity: var(--lg-noise-alpha);
  }

  /* «жидкий» блик */
  &::after {
    content: '';
    pointer-events: none;
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(60% 30% at 10% 0%, rgba(255, 255, 255, 0.12), transparent 60%);
  }

  /* Поддержка системного размытия */
  @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
    background: rgba(255, 255, 255, $opacity);
    -webkit-backdrop-filter: blur(var(--lg-blur)) saturate(var(--lg-saturation));
    backdrop-filter: blur(var(--lg-blur)) saturate(var(--lg-saturation));
  }

  /* Дисторсия (SVG filter) — читается из токена --lg-distortion */
  @supports (filter: url(#dummy)) {
    &:not(.lg--no-distort) {
      filter: url(#var); /* placeholder для каскада ниже */
      /* К сожалению, CSS custom properties не подставляются в url(#id),
         поэтому задаём utility-классы ниже. */
      filter: none;
    }
  }
}

/* Готовые высоты */
.lg,
.lg-elev-1 {
  @include lg-surface(1);
}
.lg-elev-2 {
  @include lg-surface(2);
}
.lg-elev-3 {
  @include lg-surface(3);
}
.lg-elev-4 {
  @include lg-surface(4);
}
.lg-elev-5 {
  @include lg-surface(5);
}

/* Поверхности с профилями */
.lg-navbar {
  padding: 0.75rem 1rem;
  @include lg-surface(2, var(--lg-navbar-opacity));
}
.lg-card {
  padding: 16px;
  @include lg-surface(1, var(--lg-card-opacity));
}
.lg-modal {
  padding: 24px;
  @include lg-surface(3, var(--lg-modal-opacity));
}

/* Кнопки (капсулы) */
.btn-lg {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1rem;
  border-radius: 9999px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, var(--lg-opacity));
  -webkit-backdrop-filter: blur(calc(var(--lg-blur) * 0.8)) saturate(var(--lg-saturation));
  backdrop-filter: blur(calc(var(--lg-blur) * 0.8)) saturate(var(--lg-saturation));
  color: var(--fg);
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  transition: transform 0.12s ease, box-shadow 0.12s ease, background-color 0.12s ease;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.18), inset 0 1px rgba(255, 255, 255, 0.3);
}
.btn-lg:hover {
  transform: translateY(-1px);
}
.btn-lg:active {
  transform: translateY(1px) scale(0.98);
}

/* Inputs */
.input-lg {
  width: 100%;
  padding: 14px 16px;
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 12px;
  background: rgba(255, 255, 255, calc(var(--lg-opacity) * 0.9));
  -webkit-backdrop-filter: blur(calc(var(--lg-blur) * 0.7)) saturate(var(--lg-saturation));
  backdrop-filter: blur(calc(var(--lg-blur) * 0.7)) saturate(var(--lg-saturation));
  color: var(--fg);
  outline: none;
  transition: box-shadow 0.15s ease, border-color 0.15s ease, background-color 0.15s ease;
}
.input-lg:focus {
  border-color: rgba(255, 255, 255, 0.45);
  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1), inset 0 2px 10px rgba(255, 255, 255, 0.2);
}

/* Утилиты дисторсии (SVG filters из index.html) */
.lg--distort {
  filter: url(#glass-distortion);
}
.lg--distort-light {
  filter: url(#glass-distortion-light);
}
.lg--distort-strong {
  filter: url(#glass-distortion-strong);
}
.lg--no-distort {
  filter: none !important;
}

/* Утилита shimmer (можно отключить классом) */
.lg--shimmer-off::after {
  animation: none !important;
}

/* Глобальный shimmer-оверлей (по мотивам shimmer из инструкции) */
.lg-shimmer {
  position: relative;
  overflow: hidden;
}
@keyframes liquid-flow {
  0% {
    transform: translateX(-100%) rotate(-45deg);
  }
  100% {
    transform: translateX(300%) rotate(-45deg);
  }
}
.lg-shimmer::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    45deg,
    transparent 30%,
    rgba(255, 255, 255, 0.3) 50%,
    transparent 70%
  );
  animation: liquid-flow 3s infinite;
  z-index: 1;
  pointer-events: none;
}

/* Сетка */
.grid {
  display: grid;
  gap: 16px;
}
.grid.cols-2 {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}
.grid.cols-3 {
  grid-template-columns: repeat(3, minmax(0, 1fr));
}
@media (max-width: 768px) {
  .grid.cols-2,
  .grid.cols-3 {
    grid-template-columns: 1fr;
  }
}

/* Fallback для браузеров без backdrop-filter */
@supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  .lg,
  .lg-elev-1,
  .lg-elev-2,
  .lg-elev-3,
  .lg-elev-4,
  .lg-elev-5,
  .lg-navbar,
  .lg-card,
  .lg-modal,
  .btn-lg,
  .input-lg {
    background: rgba(255, 255, 255, 0.8) !important;
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
  }
}

/* Высокий контраст — сделать стекло более плотным и читаемым */
@media (prefers-contrast: more) {
  .lg,
  .lg-elev-1,
  .lg-elev-2,
  .lg-elev-3,
  .lg-elev-4,
  .lg-elev-5,
  .lg-navbar,
  .lg-card,
  .lg-modal {
    background: rgba(255, 255, 255, 0.9) !important;
    border-width: 2px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.6);
  }
}

/* Мобильное упрощение: меньше blur, убрать дисторсию для тяжёлых контейнеров */
@media (max-width: 768px) {
  .lg--distort,
  .lg--distort-light,
  .lg--distort-strong {
    filter: none !important;
  }
}
